DROP SCHEMA IF EXISTS `SPJ414800`;
CREATE SCHEMA `SPJ414800`;
USE `SPJ414800`;

DROP TABLE IF EXISTS `S`;
DROP TABLE IF EXISTS `P`;
DROP TABLE IF EXISTS `J`;
DROP TABLE IF EXISTS `SPJ`;

CREATE TABLE `S` (
	`SNO` VARCHAR(5) PRIMARY KEY,
    `SNAME` VARCHAR(10) NOT NULL,
    `STATUS` INT,
    `CITY` VARCHAR(10)
);

CREATE TABLE `P` (
	`PNO` VARCHAR(5) PRIMARY KEY,
    `PNAME` VARCHAR(10) NOT NULL,
    `COLOR` VARCHAR(5),
    `WEIGHT` INT DEFAULT 10
);

CREATE TABLE `J` (
	`JNO` VARCHAR(5) PRIMARY KEY,
    `JNAME` VARCHAR(10) NOT NULL,
    `CITY` VARCHAR(10)
);

CREATE TABLE `SPJ` (
	`SNO` VARCHAR(5),
    `PNO` VARCHAR(5),
    `JNO` VARCHAR(5),
    `QTY` INT CHECK(`QTY` >= 1 AND `QTY` <= 10000),
    PRIMARY KEY(`SNO`, `PNO`, `JNO`),
    FOREIGN KEY (`SNO`)
		REFERENCES `S`(`SNO`)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (`PNO`)
		REFERENCES `P`(`PNO`)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
	FOREIGN KEY (`JNO`)
		REFERENCES `J`(`JNO`)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

ALTER TABLE `P` ADD COLUMN `PRICE` FLOAT;
ALTER TABLE `J` ADD COLUMN `JSTART` DATE NOT NULL;
ALTER TABLE `J` ADD COLUMN `JEND` DATE;
ALTER TABLE `J` ADD CHECK(`JEND` > `JSTART`);

INSERT INTO `S` VALUES('S1', '精益', 20, '天津');
INSERT INTO `S` VALUES('S2', '盛锡', 10, '北京');
INSERT INTO `S` VALUES('S3', '东方红', 30, '北京');
INSERT INTO `S` VALUES('S4', '丰泰盛', 20, '天津');
INSERT INTO `S` VALUES('S5', '为民', 30, '上海');

INSERT INTO `P` VALUES('P1', '螺母', '红', 12, FLOOR(2 + (RAND() * 3)));
INSERT INTO `P` VALUES('P2', '螺栓', '绿', 17, FLOOR(3 + (RAND() * 3)));
INSERT INTO `P` VALUES('P3', '螺丝刀', '蓝', 14, FLOOR(5 + (RAND() * 3)));
INSERT INTO `P` VALUES('P4', '螺丝刀', '红', 14, FLOOR(6 + (RAND() * 3)));
INSERT INTO `P` VALUES('P5', '凸轮', '蓝', 40, FLOOR(7 + (RAND() * 3)));
INSERT INTO `P` VALUES('P6', '齿轮', '红', 30, FLOOR(8 + (RAND() * 3)));

INSERT INTO `J` VALUES('J1', '三建', '北京', DATE_SUB(NOW(), INTERVAL FLOOR(RAND() * 14) DAY), DATE_ADD(NOW(), INTERVAL FLOOR(RAND() * 14) DAY));
INSERT INTO `J` VALUES('J2', '一汽', '长春', DATE_SUB(NOW(), INTERVAL FLOOR(RAND() * 14) DAY), DATE_ADD(NOW(), INTERVAL FLOOR(RAND() * 14) DAY));
INSERT INTO `J` VALUES('J3', '弹簧厂', '天津', DATE_SUB(NOW(), INTERVAL FLOOR(RAND() * 14) DAY), DATE_ADD(NOW(), INTERVAL FLOOR(RAND() * 14) DAY));
INSERT INTO `J` VALUES('J4', '造船厂', '天津', DATE_SUB(NOW(), INTERVAL FLOOR(RAND() * 14) DAY), DATE_ADD(NOW(), INTERVAL FLOOR(RAND() * 14) DAY));
INSERT INTO `J` VALUES('J5', '机车厂', '唐山', DATE_SUB(NOW(), INTERVAL FLOOR(RAND() * 14) DAY), DATE_ADD(NOW(), INTERVAL FLOOR(RAND() * 14) DAY));
INSERT INTO `J` VALUES('J6', '无线电厂', '常州', DATE_SUB(NOW(), INTERVAL FLOOR(RAND() * 14) DAY), DATE_ADD(NOW(), INTERVAL FLOOR(RAND() * 14) DAY));
INSERT INTO `J` VALUES('J7', '半导体厂', '南京', DATE_SUB(NOW(), INTERVAL FLOOR(RAND() * 14) DAY), DATE_ADD(NOW(), INTERVAL FLOOR(RAND() * 14) DAY));

INSERT INTO `SPJ` VALUES('S1', 'P1', 'J1', 200);
INSERT INTO `SPJ` VALUES('S1', 'P1', 'J3', 100);
INSERT INTO `SPJ` VALUES('S1', 'P1', 'J4', 700);
INSERT INTO `SPJ` VALUES('S1', 'P2', 'J2', 100);
INSERT INTO `SPJ` VALUES('S2', 'P3', 'J1', 400);
INSERT INTO `SPJ` VALUES('S2', 'P3', 'J2', 200);
INSERT INTO `SPJ` VALUES('S2', 'P3', 'J4', 500);
INSERT INTO `SPJ` VALUES('S2', 'P3', 'J5', 400);
INSERT INTO `SPJ` VALUES('S2', 'P5', 'J1', 400);
INSERT INTO `SPJ` VALUES('S2', 'P5', 'J2', 100);
INSERT INTO `SPJ` VALUES('S3', 'P1', 'J1', 200);
INSERT INTO `SPJ` VALUES('S3', 'P3', 'J1', 200);
INSERT INTO `SPJ` VALUES('S4', 'P5', 'J1', 100);
INSERT INTO `SPJ` VALUES('S4', 'P6', 'J3', 300);
INSERT INTO `SPJ` VALUES('S4', 'P6', 'J4', 200);
INSERT INTO `SPJ` VALUES('S5', 'P2', 'J4', 100);
INSERT INTO `SPJ` VALUES('S5', 'P3', 'J1', 200);
INSERT INTO `SPJ` VALUES('S5', 'P6', 'J2', 200);
INSERT INTO `SPJ` VALUES('S5', 'P6', 'J4', 500);